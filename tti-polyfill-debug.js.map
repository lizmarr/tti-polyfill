{"version":3,"sources":[" [synthetic:util/global] "," [synthetic:util/defineproperty] "," [synthetic:es6/symbol] "," [synthetic:es6/util/makeiterator] "," [synthetic:es6/util/arrayfromiterable] "," [synthetic:es6/util/arrayfromiterator] ","src/activityTrackerUtils.js","src/debug.js","src/firstConsistentlyInteractiveCore.js","src/firstConsistentlyInteractiveDetector.js","src/umd-wrapper.js","src/index.js"],"names":["$jscomp.global","$jscomp.defineProperty","$jscomp.initSymbol","$jscomp.Symbol","$jscomp.symbolCounter_","$jscomp.SYMBOL_PREFIX","$jscomp.arrayIterator","$jscomp.initSymbolIterator","$jscomp.iteratorPrototype","uniqueId","patchFetch","beforeRequestCb","afterRequestCb","originalFetch","fetch","Promise","resolve","reject","requestId","$jscomp.arrayFromIterable","args","then","value","err","log","console","computeLastKnownNetwork2Busy","incompleteRequestStarts","observedResourceRequests","length","performance","now","endpoints","$jscomp.makeIterator","req","push","timestamp","start","type","end","ts","sort","a","b","currentActive","i","endpoint","Error","constructor","FirstConsistentlyInteractiveDetector","config","_minValue","minValue","_networkRequests","_incompleteJSInitiatedRequestStartTimes","Map","_timerId","_timerActivationTime","Infinity","_scheduleTimerTasks","_firstConsistentlyInteractiveResolver","activityTrackerUtils.patchFetch","_registerListeners","_beforeJSInitiatedRequestCallback","bind","_afterJSInitiatedRequestCallback","getFirstConsistentlyInteractive","document","readyState","startSchedulingTimerTasks","window","addEventListener","rescheduleTimer","earliestTime","clearTimeout","setTimeout","navigationStart","timing","lastBusy","firstConsistentlyInteractiveCore.computeLastKnownNetwork2Busy","_checkTTI","_incompleteRequestStarts","searchStart","chrome","firstPaint","loadTimes","firstPaintTime","domContentLoadedEventEnd","currentTime","Math","max","maybeFCI","longTasks","set","size","delete","$jscomp.global.Object.defineProperties","values","moduleExport","opts","detector","module","exports","define","amd","ttiPolyfill"],"mappings":"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","file":"","sourcesContent":[null,null,null,null,null,null,"// Copyright 2017 Google Inc. All rights reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\nlet uniqueId = 0;\n\n\n/**\n * Overrides the native XHR send method in order to keep track of in-flight\n * network requests.\n * @param {!Function} beforeXHRSendCb\n * @param {!Function} onRequestCompletedCb\n */\nexport function patchXMLHTTPRequest(beforeXHRSendCb, onRequestCompletedCb) {\n  const send = XMLHttpRequest.prototype.send;\n  const requestId = uniqueId++;\n\n  XMLHttpRequest.prototype.send = function(...args) { // No arrow function.\n    beforeXHRSendCb(requestId);\n    this.addEventListener('readystatechange', () => {\n      // readyState 4 corresponds to 'DONE'\n      if (this.readyState === 4) onRequestCompletedCb(requestId);\n    });\n    return send.apply(this, args);\n  };\n}\n\n\n/**\n * Overrides the native fetch() in order to keep track of in-flight network\n * requests.\n * @param {!Function} beforeRequestCb\n * @param {!Function} afterRequestCb\n */\nexport function patchFetch(beforeRequestCb, afterRequestCb) {\n  const originalFetch = fetch;\n\n  // TODO(philipwalton): assign this to a property of the global variable\n  // explicitely rather than implicitely.\n  // eslint-disable-next-line no-global-assign\n  fetch = (...args) => {\n    return new Promise((resolve, reject) => {\n      const requestId = uniqueId++;\n      beforeRequestCb(requestId);\n      originalFetch(...args).then(\n          (value) => {\n            afterRequestCb(requestId);\n            resolve(value);\n          },\n          (err) => {\n            afterRequestCb(err);\n            reject(err);\n          });\n    });\n  };\n}\n\n\n/** @type {!Array<string>} */\nconst requestCreatingNodeNames =\n    ['img', 'script', 'iframe', 'link', 'audio', 'video', 'source'];\n\n\n/**\n * Determines if a node or its descendants match one of the passed node names.\n * @param {!Array<!Node>|!NodeList<!Node>} nodes\n * @param {!Array<string>} nodeNames\n * @return {boolean}\n */\nfunction subtreeContainsNodeName(nodes, nodeNames) {\n  for (const node of nodes) {\n    if (nodeNames.includes(node.nodeName.toLowerCase()) ||\n        subtreeContainsNodeName(node.children, nodeNames)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n\n/**\n * Start observing DOM mutations for added nodes that may initiate network\n * requests.\n * @param {!Function} callback\n * @return {!MutationObserver}\n */\nexport function observeResourceFetchingMutations(callback) {\n  const mutationObserver = new MutationObserver((mutations) => {\n    // Typecast to fix: https://github.com/google/closure-compiler/issues/2539\n    // eslint-disable-next-line no-self-assign\n    mutations = /** @type {!Array<!MutationRecord>} */ (mutations);\n\n    for (const mutation of mutations) {\n      if (mutation.type == 'childList' &&\n          subtreeContainsNodeName(\n              mutation.addedNodes, requestCreatingNodeNames)) {\n        callback(mutation);\n      } else if (mutation.type == 'attributes' &&\n          requestCreatingNodeNames.includes(\n              mutation.target.tagName.toLowerCase())) {\n        callback(mutation);\n      }\n    }\n  });\n\n  mutationObserver.observe(document, {\n    attributes: true,\n    childList: true,\n    subtree: true,\n    attributeFilter: ['href', 'src'],\n  });\n\n  return mutationObserver;\n}\n","// Copyright 2017 Google Inc. All rights reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n/**\n * @define {boolean}\n */\nlet DEBUG = true;\n\n\n/**\n * Prints a log statement to the console if the DEBUG flag is true.\n * @param {...*} args\n */\nexport const log = (...args) => {\n  if (DEBUG) {\n    // eslint-disable-next-line no-console\n    console.log(...args);\n  }\n};\n","// Copyright 2017 Google Inc. All rights reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n/**\n * Computes the first consistently interactive value...\n * @param {number} searchStart\n * @param {number} minValue\n * @param {number} lastKnownNetwork2Busy\n * @param {number} currentTime\n * @param {!Array<{start: (number), end: (number)}>} longTasks\n * @return {number|null}\n */\nexport const computeFirstConsistentlyInteractive =\n    (searchStart, minValue, lastKnownNetwork2Busy, currentTime, longTasks) => {\n  // Have not reached network 2-quiet yet.\n  if ((currentTime - lastKnownNetwork2Busy) < 5000) return null;\n\n  const maybeFCI = longTasks.length === 0 ?\n      searchStart : longTasks[longTasks.length - 1].end;\n\n  // Main thread has not been quiet for long enough.\n  if (currentTime - maybeFCI < 5000) return null;\n\n  return Math.max(maybeFCI, minValue);\n};\n\n\n/**\n * Computes the time (in milliseconds since requestStart) that the network was\n * last known to have >2 requests in-flight.\n * @param {!Array<number>} incompleteRequestStarts\n * @param {!Array<{start: (number), end: (number)}>} observedResourceRequests\n * @return {number}\n */\nexport const computeLastKnownNetwork2Busy =\n      (incompleteRequestStarts, observedResourceRequests) => {\n  if (incompleteRequestStarts.length > 2) return performance.now();\n\n  const endpoints = [];\n  for (const req of observedResourceRequests) {\n    endpoints.push({\n      timestamp: req.start,\n      type: 'requestStart',\n    });\n    endpoints.push({\n      timestamp: req.end,\n      type: 'requestEnd',\n    });\n  }\n\n  for (const ts of incompleteRequestStarts) {\n    endpoints.push({\n      timestamp: ts,\n      type: 'requestStart',\n    });\n  }\n\n  endpoints.sort((a, b) => a.timestamp - b.timestamp);\n\n  let currentActive = incompleteRequestStarts.length;\n\n  for (let i = endpoints.length - 1; i >= 0; i--) {\n    const endpoint = endpoints[i];\n    switch (endpoint.type) {\n      case 'requestStart':\n        currentActive--;\n        break;\n      case 'requestEnd':\n        currentActive++;\n        if (currentActive > 2) {\n          return endpoint.timestamp;\n        }\n        break;\n      default:\n        throw Error('Internal Error: This should never happen');\n    }\n  }\n\n  // If we reach here, we were never network 2-busy.\n  return 0;\n};\n","// Copyright 2017 Google Inc. All rights reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport * as activityTrackerUtils from './activityTrackerUtils.js';\nimport {log} from './debug.js';\nimport * as firstConsistentlyInteractiveCore\n    from './firstConsistentlyInteractiveCore.js';\n\n\n/**\n * Class to detect first consistently interactive.\n */\nexport default class FirstConsistentlyInteractiveDetector {\n  /**\n   * @param {!FirstConsistentlyInteractiveDetectorInit=} config\n   */\n  constructor(config = {}) {\n    this._useMutationObserver = !!config.useMutationObserver;\n\n    // If minValue is null, by default it is DOMContentLoadedEnd.\n    this._minValue = config.minValue || null;\n\n    this._networkRequests = [];\n    this._incompleteJSInitiatedRequestStartTimes = new Map();\n\n    this._timerId = null;\n    this._timerActivationTime = -Infinity;\n\n    // Timer tasks are only scheduled when detector is enabled.\n    this._scheduleTimerTasks = false;\n\n    /** @type {?Function} */\n    this._firstConsistentlyInteractiveResolver = null;\n\n    this._registerListeners();\n  }\n\n  /**\n   * Starts checking for a first consistently interactive time and returns a\n   * promise that resolves to the found time.\n   * @return {!Promise<number>}\n   */\n  getFirstConsistentlyInteractive() {\n    return new Promise((resolve, reject) => {\n      this._firstConsistentlyInteractiveResolver = resolve;\n\n      if (document.readyState == 'complete') {\n        this.startSchedulingTimerTasks();\n      } else {\n        window.addEventListener('load', () => {\n          // You can use this to set a custom minimum value.\n          // this.setMinValue(20000);\n\n          this.startSchedulingTimerTasks();\n        });\n      }\n    });\n  }\n\n  /**\n   * Starts scheduling the timer that checks for network quiescence (a 5-second\n   * window of no more than 2 in-flight network requests).\n   */\n  startSchedulingTimerTasks() {\n    log(`Enabling FirstConsistentlyInteractiveDetector`);\n\n    this._scheduleTimerTasks = true;\n\n    this.rescheduleTimer(0);\n  }\n\n  /**\n   * Setter for the `_minValue` property.\n   * @param {number} minValue\n   */\n  setMinValue(minValue) {\n    this._minValue = minValue;\n  }\n\n  /**\n   * Resets the timer that checks for network quiescence.\n   * @param {number} earliestTime A timestamp in ms, and the time is relative\n   *     to navigationStart.\n   */\n  rescheduleTimer(earliestTime) {\n    // Check if ready to start looking for firstConsistentlyInteractive\n    if (!this._scheduleTimerTasks) {\n      log(`startSchedulingTimerTasks must be called before ` +\n          `calling rescheduleTimer`);\n\n      return;\n    }\n\n    log(`Attempting to reschedule FirstConsistentlyInteractive ` +\n        `check to ${earliestTime}`);\n    log(`Previous timer activation time: ${this._timerActivationTime}`);\n\n    if (this._timerActivationTime > earliestTime) {\n      log(`Current activation time is greater than attempted ` +\n          `reschedule time. No need to postpone.`);\n\n      return;\n    }\n    clearTimeout(this._timerId);\n    this._timerId = setTimeout(() => {\n      this._checkTTI();\n    }, earliestTime - performance.now());\n    this._timerActivationTime = earliestTime;\n\n    log(`Rescheduled firstConsistentlyInteractive check at ${earliestTime}`);\n  }\n\n  /**\n   * Removes all timers and event listeners.\n   */\n  disable() {\n    log(`Disabling FirstConsistentlyInteractiveDetector`);\n\n    clearTimeout(this._timerId);\n    this._scheduleTimerTasks = false;\n    this._unregisterListeners();\n  }\n\n  /**\n   * Registers listeners to detect XHR, fetch, resource timing entries, and\n   * DOM mutations to detect long tasks and network quiescence.\n   */\n  _registerListeners() {\n    activityTrackerUtils.patchFetch(\n        this._beforeJSInitiatedRequestCallback.bind(this),\n        this._afterJSInitiatedRequestCallback.bind(this));\n  }\n\n  /**\n   * Removes all added listeners.\n   */\n  _unregisterListeners() {\n    // We will leave the XHR / Fetch objects the way they were,\n    // since we cannot guarantee they were not modified further in between.\n  }\n\n  /**\n   * A callback to be run before any new XHR requests. This adds the request\n   * to a map so in-flight requests can be tracked.\n   * @param {string} requestId\n   */\n  _beforeJSInitiatedRequestCallback(requestId) {\n    log(`Starting JS initiated request. Request ID: ${requestId}`);\n\n    this._incompleteJSInitiatedRequestStartTimes.set(\n        requestId, performance.now());\n\n    log(`Active XHRs: ${this._incompleteJSInitiatedRequestStartTimes.size}`);\n  }\n\n  /**\n   * A callback to be run once any XHR requests have completed. This removes\n   * the request from the in-flight request map.\n   * @param {string} requestId\n   */\n  _afterJSInitiatedRequestCallback(requestId) {\n    log(`Completed JS initiated request with request ID: ${requestId}`);\n\n    this._incompleteJSInitiatedRequestStartTimes.delete(requestId);\n\n    log(`Active XHRs: ${this._incompleteJSInitiatedRequestStartTimes.size}`);\n  }\n\n  /**\n   * Returns either a manually set min value or the time since\n   * domContentLoadedEventEnd and navigationStart. If the\n   * domContentLoadedEventEnd data isn't available, `null` is returned.\n   * @return {number|null}\n   */\n  _getMinValue() {\n    if (this._minValue) return this._minValue;\n\n    if (performance.timing.domContentLoadedEventEnd) {\n      const {domContentLoadedEventEnd, navigationStart} = performance.timing;\n      return domContentLoadedEventEnd - navigationStart;\n    }\n\n    return null;\n  }\n\n  /**\n   * Gets a list of all in-flight requests.\n   * @return {!Array}\n   */\n  get _incompleteRequestStarts() {\n    return [...this._incompleteJSInitiatedRequestStartTimes.values()];\n  }\n\n  /**\n   * Checks to see if a first consistently interactive time has been found.\n   * If one has been found, the promise resolver is invoked with the time. If\n   * no time has been found, the timeout detecting the quiet window is reset.\n   */\n  _checkTTI() {\n    log(`Checking if First Consistently Interactive was reached...`);\n\n    const navigationStart = performance.timing.navigationStart;\n    const lastBusy =\n        firstConsistentlyInteractiveCore.computeLastKnownNetwork2Busy(\n            this._incompleteRequestStarts, this._networkRequests);\n\n    // First paint is not available in non-chrome browsers at the moment.\n    const firstPaint = window.chrome && window.chrome.loadTimes ?\n        (window.chrome.loadTimes().firstPaintTime * 1000 - navigationStart) : 0;\n\n    const searchStart = firstPaint || (\n        performance.timing.domContentLoadedEventEnd - navigationStart);\n\n    const minValue = this._getMinValue();\n    const currentTime = performance.now();\n\n    // Ideally we will only start scheduling timers after DOMContentLoaded and\n    // this case should never be hit.\n    if (minValue === null) {\n      log(`No usable minimum value yet. Postponing check.`);\n\n      this.rescheduleTimer(Math.max(lastBusy + 5000, currentTime + 1000));\n    }\n\n    log(`Parameter values:`);\n    log(`NavigationStart`, navigationStart);\n    log(`lastKnownNetwork2Busy`, lastBusy);\n    log(`Search Start`, searchStart);\n    log(`Min Value`, minValue);\n    log(`Last busy`, lastBusy);\n    log(`Current time`, currentTime);\n    log(`Incomplete JS Request Start Times`, this._incompleteRequestStarts);\n    log(`Network requests`, this._networkRequests);\n\n    const maybeFCI =\n        firstConsistentlyInteractiveCore.computeFirstConsistentlyInteractive(\n            searchStart, /** @type {number} */ (minValue), lastBusy,\n            currentTime, []);\n\n    if (maybeFCI) {\n      this._firstConsistentlyInteractiveResolver(\n          /** @type {number} */ (maybeFCI));\n      this.disable();\n    }\n\n    // First Consistently Interactive was not reached for whatever reasons.\n    // Check again in one second. Eventually we should become confident enough\n    // in our scheduler logic to get rid of this step.\n    log(`Could not detect First Consistently Interactive. ` +\n        `Retrying in 1 second.`);\n\n    this.rescheduleTimer(performance.now() + 1000);\n  }\n}\n","// Copyright 2017 Google Inc. All rights reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\n/* global define, module */\n\n\nimport {getFirstConsistentlyInteractive} from './index.js';\n\n\nconst moduleExport = {getFirstConsistentlyInteractive};\n\n\nif (typeof module != 'undefined' && module.exports) {\n  module.exports = moduleExport;\n} else if (typeof define === 'function' && define.amd) {\n  define('ttiPolyfill', [], () => moduleExport);\n} else {\n  window.ttiPolyfill = moduleExport;\n}\n","// Copyright 2017 Google Inc. All rights reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n\nimport FirstConsistentlyInteractiveDetector\n    from './firstConsistentlyInteractiveDetector.js';\n\n\n/**\n * Returns a promise that resolves to the first consistently interactive time\n * (in milliseconds) or null if the browser doesn't support the features\n * required for detection.\n * @param {!FirstConsistentlyInteractiveDetectorInit=} opts Configuration\n *     options for the polyfill\n * @return {!Promise} TODO(philipwalton): for some reason the type\n *     {!Promise<(number|null)>} isn't working here, check if this is fixed in\n *     a new version of closure compiler.\n */\nexport const getFirstConsistentlyInteractive = (opts = {}) => {\n  if ('PerformanceLongTaskTiming' in window) {\n    const detector = new FirstConsistentlyInteractiveDetector(opts);\n    return detector.getFirstConsistentlyInteractive();\n  } else {\n    return Promise.resolve(null);\n  }\n};\n"]}